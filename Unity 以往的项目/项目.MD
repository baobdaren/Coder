# 回忆项目内容

## 客户端

1. 聊天（点击响应，图文混排）
    聊天界面主要使用Unity的ProTextMesh，这个插件提供了很多聊天界面可以用到的功能，比如点击文字事件，插入图片功能，文字着色功能等。

    服务端则有单独的聊天模块承担。
    客户端根据UI上的各种状态判断状态和需要携带的信息（如当：当前激活的频道或目标玩家ID，发送框中内容，玩家部分状态），然后以有格式的字符串的方式，发送给服务端。服务端的当前玩家的实体继续处理消息（是否能够发送，消耗物品是否存在并足够），添加一些信息（如：等级，VIP状态，称号等）。通过以上检测后，发送给消息转发模块。在消息转发模块中将消息发送给特定范围的人（指定id的玩家，或是世界中所有玩家，或是部分玩家）。
    客户端接受消息并显示。

2. 登录（）

    登陆界面通过发送登录信息（用户名和密码）来请求登录，登录成功后服务端向客户端发送登录结果（密码错误，没有账号，登录成功），客户端处理登录结果。

3. 创建/选择角色（UI和粒子层级，）
    选择和创建角色界面公用六个角色的图片，选择号角色后会像服务器请求角色信息，客户端依据返回的信息（职业，性别）来显示图片。创建角色则依据客户端角色选择的相关UI信息（性别选择状态按钮，职业选择状态按钮）等来显示角色图片。创建角色提交信息需要本地和服务端都判断是否合格（长度，敏感字）。服务端确认角色可以创建后（判断角色名重复）则写入数据库角色信息。并告知客户端角色创建成功。客户端此时返回选择界面，并选中最新创建的角色。选择角色后。调用服务端登录函数，服务端确认可以登陆后，向客户端返回角色信息，客户端相应实体创建并创建场景。

4. 人物属性界面  
    UI界面的设计，各个属性。  
    服务端可以通过属性赋值事件来修改客户端属性，所以任务属性的修改主要涉及服务端。

5. GM工具
    GM工具在场景加载时同时加载，GM工具主要包含了场景跳转，位置跳转，装备生成，属性（经验，金币）修改。GM工具在服务端修改写与正常不同的操作时，会验证当前的角色是否为GM账号，这个属性需要在数据库中直接修改。GM工具的功能，都是以当前玩家实体，调用服务端逻辑。

6. Unity编辑器功能
    对于一些大量重复的操作（如2D地图布置，大量Sprite创建，怪物位置布置，数据导入导出，资源修改）。

## 服务端

1. 怪物衍生  （动态分批创建，复活对象池）
    场景初始创建时由于怪物的数量非常多，一次性创建会导致不同进程之间丢失联系，所以需要采用延时分批创建策略。怪物分布参数和关键行为参数，保存在json文件中。场景实体创建怪物之前，会读取json文件内容，并保存在内存中。创建怪物时，则依据json中的配置（数量，范围，类型，等级等）创建相应实体。

2. 战斗的部分逻辑
    依据策划文档，完善数值计算的逻辑，对接技能和数值计算，属性。

3. 技能释放
    这个模块不是自己写的。  
    Trap类型，这是一个陷阱类型，范围是单个瓷片的大小。复杂形状的技能则由这个基本形状组合而成。  
    技能分三个类型，及时生效，飞行道具，闪电打击。  
    及时生效技能不需要延时。  
    飞行道具类技能则需要在技能释放后，以释放者和目标为距离，通过速度，计算到达事件。客户端还要计算每一帧的位置。到达目标或者距离小于阈值后，出发伤害。  
    闪电打击类技能，释放技能后也需要定时，定时结束后触发伤害。客户端则需要在释放和触发伤害时播放释放技能动画。  