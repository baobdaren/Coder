回忆项目内容

## 客户端（Lua+C#）
* 大地图加载（九宫格，动态加载NPC和建筑，其他玩家的预测显示）
    大地图采用基于九宫格动态加载方式。即地图的美术资源分割为多个区块，存储时保存其位置信息，程序根据规则加载玩家周围的区块及其区块上的对象。由于地图的矩形，所有先加载包含玩家的方块，再加载玩家周边的八个方块（可以采用玩家周边圆形区域），移动到新的方块时，看情况卸载其他方块（对于主城可以适当保留，因为玩家频繁使用回城）。地图中的建筑和NPC则采用动态加载和卸载，根据设备内存，卸载距离（平方）过远的（删除或者禁用一些组件）。

* 聊天（点击响应，图文混排，响应面板，频道分发）
    聊天界面主要使用Unity的TextMeshPro插件实现，这个插件提供了很多聊天界面可以用到的功能，比如点击文字事件，插入图片功能，文字着色功能等。

    服务端则有单独的聊天模块承担。
    客户端根据UI上的各种状态判断状态和需要携带的信息（如当：当前激活的频道或目标玩家ID，发送框中内容，玩家部分状态），然后以有格式的字符串的方式，发送给服务端。服务端的当前玩家的实体继续处理消息（是否能够发送，消耗物品是否存在并足够），添加一些信息（如：等级，VIP状态，称号等）。通过以上检测后，发送给消息转发模块。在消息转发模块中将消息发送给特定范围的人（指定id的玩家，或是世界中所有玩家，或是部分玩家）。
    KBE：聊天系统在一个Cell里
    客户端发送聊天信息时，通过参数或者特殊分割来发送更多信息，比如发送对象，发送团体，Cell逻辑检查这些信息再发送消息给他们
    客户端：根据服务端发送的信息，解析字符串，显示在对应频道，对特殊字符处理如显示超链接对应的装备

* 创建/选择角色（UI和粒子层级问题，敏感词检测）
    选择和创建角色界面公用六个角色的图片，选择好角色后会向服务器请求角色信息，客户端依据返回的信息（职业，性别）来显示图片。创建角色则依据客户端角色选择的相关UI信息（性别选择状态按钮，职业选择状态按钮）等来显示角色图片。创建角色提交信息需要本地和服务端都判断是否合格（长度，敏感字）。服务端确认角色可以创建后（判断角色名重复）则写入数据库角色信息。并告知客户端角色创建成功。客户端此时返回选择界面，并选中最新创建的角色。选择角色后。调用服务端登录函数，服务端确认可以登陆后，向客户端返回角色信息，客户端相应实体创建并创建场景。

* 人物属性界面（数据请求，详情浏览，）
    TMP尽量不与Image重叠，不要交叉
    客户端从本地获取信息或者从服务端请求。请求信息解析。
    服务端从数据库或者Cache（缓存的玩家信息）中获取信息后返回给服务端。
    玩家同盟信息是保存在数据库中，保存同盟ID，同盟创建则是创建新的表。加入同盟则列出所有同盟总表的内容。

* 人物物品单独列表，物品ID，数量，绑定，其他信息（时间，归属）
    自动使用：血包和蓝可以在设置里自动使用，分不同类别，按照策划文档对应设置执行。
    物品不拆分，且自动堆叠，即存档该物体时，服务端指挥增加其数量，否则创建1个。
    拖拽和放置：拖拽开始后保存原有位置，并使图标跟随，拖拽结束后如果不可用则回到原来位置，如果可用则修改位置序号，如果已有物品，则同时修改双方序号（可能是有个临时位置？记不清了）
    删除：点击删除时可选择数量，服务端检查后减去数值后检测，为0则清空给否则只减去一部分

* GM工具（等级设置，装备生成，金币增加）
    GM工具在场景加载时同时加载，GM工具主要包含了快速传送跳转，装备生成，属性（经验，金币）修改。GM工具在服务端修改写与正常不同的操作时，会验证当前的角色是否为GM账号，这个属性需要在数据库中直接修改。GM工具的功能，都是以当前玩家实体，调用服务端逻辑。

* Buff
    角色Entity身上buff是其他Entity
    这些buff有ID，效果类型，参数，倒计时时间等。这些通过读取本地文档可以得到，服务端也有文档读取来进行相关计算。

* 传送/回城
    玩家位置在传送门上时，回调调用按照策划文件，传送到指定ID的场景的出口，注意不要传送到下一个传送门。
    小随机传送：服务端有可行走坐标列表的数据，随机传送会在这个表中查找位置。
    大随机传送：大传送可以跨场景，但必须符合文档给出的条件。（等级之下的）。
    回城：直接传送到文档指定该道具指定场景的指定位置。

* 杂项
    伤害数字：数值飘动效果，选择伤害数字而不是减血数字。因为会大量复用采用对象池方式。  
    任务提示框：服务端发送信息，客户端解析（主要是自动移动到某个位置，可能还要到达后开启对话或者触发到达回调）

* Unity编辑器功能  
    * 2D瓷片地图中NPC，怪物等对象的布置。
    * 数据的导入导出。
    * 批量资源修改。

## 服务端（KBEngine服务端引擎 Python脚本逻辑）

1. 怪物衍生  （动态分批创建，对象池保存复用）
    场景初始创建时由于怪物的数量非常多，一次性创建会导致不同进程之间丢失联系，所以需要采用延时分批创建策略。怪物分布参数和关键行为参数，保存在json文件中。场景实体创建怪物之前，会读取json文件内容，并保存在内存中。创建怪物时，则依据json中的配置（数量，范围，类型，等级等）创建相应实体。

2. 战斗逻辑
    依据策划文档，完善数值计算的逻辑，对接技能和数值计算，属性。

3. 技能释放
    Trap类型，这是一个陷阱类型，技能分三类型：及时生效，飞行道具，闪电打击。 
    范围是单个瓷片的大小。复杂形状的技能则由这个基本形状组合而成。  
     
    及时生效技能不需要延时。  
    飞行道具类技能则需要在技能释放后，以释放者和目标为距离，通过速度，计算到达事件。客户端还要计算每一帧的位置。到达目标或者距离小于阈值后，触发伤害请求。  
    闪电打击类技能，释放技能后也需要定时，定时结束后触发伤害。客户端则需要在释放和触发伤害时播放释放技能动画。  
